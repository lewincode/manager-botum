const { Client, ButtonBuilder, TextInputBuilder, ModalBuilder, ActionRowBuilder, SelectMenuBuilder, EmbedBuilder, GatewayIntentBits, Partials } = require("discord.js");
const config = require("./config");
const db = require('croxydb');

const client = new Client({
  partials: [
    Partials.Message, // for message
    Partials.Channel, // for text channel
    Partials.GuildMember, // for guild member
    Partials.Reaction, // for message reaction
    Partials.GuildScheduledEvent, // for guild events
    Partials.User, // for discord user
    Partials.ThreadMember, // for thread member
  ],
  intents: [
    GatewayIntentBits.Guilds, // for guild related things
    GatewayIntentBits.GuildMembers, // for guild members related things
    GatewayIntentBits.GuildBans, // for manage guild bans
    GatewayIntentBits.GuildEmojisAndStickers, // for manage emojis and stickers
    GatewayIntentBits.GuildIntegrations, // for discord Integrations
    GatewayIntentBits.GuildWebhooks, // for discord webhooks
    GatewayIntentBits.GuildInvites, // for guild invite managing
    GatewayIntentBits.GuildVoiceStates, // for voice related things
    GatewayIntentBits.GuildPresences, // for user presence things
    GatewayIntentBits.GuildMessages, // for guild messages things
    GatewayIntentBits.GuildMessageReactions, // for message reactions things
    GatewayIntentBits.GuildMessageTyping, // for message typing things
    GatewayIntentBits.DirectMessages, // for dm messages
    GatewayIntentBits.DirectMessageReactions, // for dm message reaction
    GatewayIntentBits.DirectMessageTyping, // for dm message typinh
    GatewayIntentBits.MessageContent, // enable if you need message content things
  ],
});

module.exports = client;

require("./events/message.js")
require("./events/ready.js")

client.login(config.token || process.env.TOKEN).catch(e => {
console.log("1")
})







///////////////////////////KOMUTLAR

const soru = require("./ayar.js");

client.on("interactionCreate", async (i) => {

  const modal = new ModalBuilder()
  .setCustomId('ybasvuru')
  .setTitle('Yetkili Ba≈üvuru')
  .setComponents(
    new ActionRowBuilder()
      .setComponents(
        new TextInputBuilder()
        .setCustomId("soru1")
        .setLabel(`${soru.soru1}`)
        .setStyle(1)
        .setMinLength(5)
        .setMaxLength(20)
        .setPlaceholder(`${soru.cevap1}`)
        .setRequired(true),
      ),
    new ActionRowBuilder()
      .setComponents(
        new TextInputBuilder()
        .setCustomId("soru2")
        .setLabel(`${soru.soru2}`)
        .setStyle(1)
        .setMinLength(1)
        .setMaxLength(10)
        .setPlaceholder(`${soru.cevap2}`)
        .setRequired(true)
      ),
    new ActionRowBuilder()
      .setComponents(
        new TextInputBuilder()
        .setCustomId("soru3")
        .setLabel(`${soru.soru3}`)
        .setStyle(1)
        .setMinLength(5)
        .setMaxLength(100)
        .setPlaceholder(`${soru.cevap3}`)
        .setRequired(true)
      ),
      new ActionRowBuilder()
      .setComponents(
          new TextInputBuilder()
          .setCustomId("soru4")
          .setLabel(`${soru.soru4}`)
          .setStyle(1)
          .setMinLength(5)
          .setMaxLength(100)
          .setPlaceholder(`${soru.cevap4}`)
          .setRequired(true)
      ),
    new ActionRowBuilder()
      .setComponents(
          new TextInputBuilder()
          .setCustomId("soru5")
          .setLabel(`${soru.soru5}`)
          .setStyle(1)
          .setMinLength(5)
          .setMaxLength(100)
          .setPlaceholder(`${soru.cevap5}`)
          .setRequired(true)
      )
  )
  if (i.customId === "basvuru_buton") {
      i.showModal(modal)
  }
  let message ;
  let logKanalƒ± = client.channels.cache.get(config.logKanalƒ±)

  if (i.customId === "ybasvuru") {

      const kabulet = new ButtonBuilder()
      .setCustomId("basvuru_kabul")
      .setLabel("Kabul Et")
      .setStyle(3)
      .setEmoji("‚úÖ")

      const reddet = new ButtonBuilder()
      .setCustomId("basvuru_red")
      .setLabel("Reddet")
      .setStyle(1)
      .setEmoji("‚ùå")

      const row4 = new ActionRowBuilder()
      .addComponents(kabulet,reddet)

      
      const soru1 = i.fields.getTextInputValue("soru1");
      const soru2 = i.fields.getTextInputValue("soru2");
      const soru3 = i.fields.getTextInputValue("soru3");
      const soru4 = i.fields.getTextInputValue("soru4");
      const soru5 = i.fields.getTextInputValue("soru5");

      const kral = new EmbedBuilder()
      .setColor("Random")
      .setAuthor({ name: `${i.guild.name} Ba≈üvuru Sistemi`})
      .setThumbnail(i.guild.iconURL())
      .setDescription(`
      **${i.user.tag}** - (\`${i.user.id}\`) ** Kullanƒ±cƒ±sƒ±nƒ±n Ba≈üvuru Formu**
      
      **${soru.soru1}**
      \`${soru1}\`
      **${soru.soru2}**
      \`${soru2}\`
      **${soru.soru3}**
      \`${soru3}\`
      **${soru.soru4}**
      \`${soru4}\`
      **${soru.soru5}**
      \`${soru5}\`
      `)
      .setTimestamp()

      await i.reply({ content: `Ba≈üvurun alƒ±ndƒ±`, ephemeral: true})
      message = await logKanalƒ±.send({ content: `${i.user}`, embeds: [kral], components: [row4]})
      db.set(message.id,i.user.id)
  }

  const basvuruDurum = client.channels.cache.get(config.basvuruDurum)

  if (i.customId === "basvuru_kabul") {

      if (!i.member.roles.cache.has(config.basvuruYt)) return i.reply({ content: `Ba≈üvuruyu yanƒ±tlamak i√ßin <@&${config.basvuruYt}> rol√ºne sahip olmalƒ±sƒ±n`, ephemeral: true})

      const kabulet2 = new ButtonBuilder()
      .setCustomId("basvuru_kabul")
      .setLabel("Kabul Edildi")
      .setStyle(3)
      .setEmoji("‚úÖ")
      .setDisabled(true)


      const row5 = new ActionRowBuilder()
      .addComponents(kabulet2)

      i.update({ components: [row5]})
      let ki≈üi = db.get(i.message.id)
      let kullanƒ±cƒ± = i.client.guilds.cache.get(config.guildID).members.cache.get(ki≈üi) 
      kullanƒ±cƒ±.roles.add(config.yetkiRolleri)
      await basvuruDurum.send({ content: `> <@${ki≈üi}>,Ba≈üvurunuz kabul edildi  ekimize ho≈ügeldiniz <a:green:1091729532249186397>  \n> **Sizi onaylayan ki≈üi: **${i.user.toString()}`})
      kullanƒ±cƒ±.user.send(`Yetkili Ba≈üvurun Ba≈üarƒ±yla **Onaylanmƒ±≈ütƒ±r**`).catch(() => {});
      db.delete(i.message.id)
  } 
  if (i.customId === "basvuru_red") {

      let ki≈üi = db.get(i.message.id)
      let kullanƒ±cƒ± = i.client.guilds.cache.get(config.guildID).members.cache.get(ki≈üi)

      const reddet2 = new ButtonBuilder()
      .setCustomId("ba≈üvuru_red")
      .setLabel("Reddedildi")
      .setStyle(1)
      .setEmoji("‚ùå")
      .setDisabled(true)

      const row6 = new ActionRowBuilder()
      .addComponents(reddet2)
      await basvuruDurum.send({ content: `> <@${ki≈üi}>, Yetkili ba≈üvurun kabul edilmedi <a:red:1086374243404619886> \n> **Sizi onaylamayan ki≈üi: **${i.user.toString()}`})
      i.update({ components: [row6]})
      kullanƒ±cƒ±.user.send(`Yetkili ba≈üvurun Kabul edilmedi`).catch(() => {});
      db.delete(i.message.id)
  }
})
//√ñNERƒ∞ 
client.on("interactionCreate", async (i) => {

  const modal = new ModalBuilder()
  .setCustomId('yoneri')
  .setTitle('√ñneri Sistemi')
  .setComponents(
    new ActionRowBuilder()
      .setComponents(
          new TextInputBuilder()
          .setCustomId("soru6")
          .setLabel(`${soru.soru6}`)
          .setStyle(1)
          .setMinLength(5)
          .setMaxLength(100)
          .setPlaceholder(`${soru.cevap6}`)
          .setRequired(true)
      )
  )
  if (i.customId === "oneri") {
      i.showModal(modal)
  }
  let message ;
  let onerikanal = client.channels.cache.get(config.onerikanal)

  if (i.customId === "yoneri") {

      const kabulet1 = new ButtonBuilder()
      .setCustomId("basvuru_kabul1")
      .setLabel("√ñneri")
      .setStyle(3)
      .setEmoji("üõ°Ô∏è")

  
      const row4 = new ActionRowBuilder()
      .addComponents(kabulet1)

      
      const soru6 = i.fields.getTextInputValue("soru6");

      const kral = new EmbedBuilder()
      .setColor("Random")
      .setAuthor({ name: `${i.guild.name} √ñneri sistemi`})
      .setThumbnail(i.guild.iconURL())
      .setDescription(`
      **${i.user.tag}** - (\`${i.user.id}\`) ** √ñneri formu**
      
      **${soru.soru6}**
      \`${soru6}\`
      `)
      .setTimestamp()

      await i.reply({ content: `√ñneriniz ba≈üarƒ±yla alƒ±ndƒ± umarƒ±m yapƒ±lƒ±r`, ephemeral: true})
      message = await onerikanal.send({ content: `${i.user}`, embeds: [kral], components: [row4]})
      db.set(message.id,i.user.id)
  }

  const basvuruDurum = client.channels.cache.get(config.basvuruDurum)
})

//≈üikayet
client.on("interactionCreate", async (i) => {

  const modal = new ModalBuilder()
  .setCustomId('ysikayet')
  .setTitle('≈ûikayet Sistemi')
  .setComponents(
    new ActionRowBuilder()
      .setComponents(
          new TextInputBuilder()
          .setCustomId("soru7")
          .setLabel(`${soru.soru7}`)
          .setStyle(1)
          .setMinLength(5)
          .setMaxLength(100)
          .setPlaceholder(`${soru.cevap7}`)
          .setRequired(true)
      )
  )
  if (i.customId === "sikayet") {
      i.showModal(modal)
  }
  let message ;
  let sikayetkanal = client.channels.cache.get(config.sikayetkanal)

  if (i.customId === "ysikayet") {

      const kabulet2 = new ButtonBuilder()
      .setCustomId("basvuru_kabul2")
      .setLabel("≈ûikayet")
      .setStyle(3)
      .setEmoji("‚öíÔ∏è")

  
      const row4 = new ActionRowBuilder()
      .addComponents(kabulet2)

      
      const soru7 = i.fields.getTextInputValue("soru7");

      const kral = new EmbedBuilder()
      .setColor("Random")
      .setAuthor({ name: `${i.guild.name} ≈ûikayet sistemi`})
      .setThumbnail(i.guild.iconURL())
      .setDescription(`
      **${i.user.tag}** - (\`${i.user.id}\`) ** ≈ûikayet formu**
      
      **${soru.soru7}**
      \`${soru7}\`
      `)
      .setTimestamp()

      await i.reply({ content: `≈ûikayetiniz ba≈üarƒ±yla alƒ±ndƒ± umarƒ±m d√ºzeltilir`, ephemeral: true})
      message = await sikayetkanal.send({ content: `${i.user}`, embeds: [kral], components: [row4]})
      db.set(message.id,i.user.id)
  }

  const basvuruDurum = client.channels.cache.get(config.basvuruDurum)
})
// yayƒ±n
client.on("interactionCreate", async (i) => {

  const modal = new ModalBuilder()
  .setCustomId('yayinci')
  .setTitle('Yayƒ±ncƒ± ba≈üvuru')
  .setComponents(
    new ActionRowBuilder()
      .setComponents(
        new TextInputBuilder()
        .setCustomId("soru9")
        .setLabel(`${soru.soru9}`)
        .setStyle(1)
        .setMinLength(5)
        .setMaxLength(20)
        .setPlaceholder(`${soru.cevap9}`)
        .setRequired(true),
      ),
    new ActionRowBuilder()
      .setComponents(
        new TextInputBuilder()
        .setCustomId("soru8")
        .setLabel(`${soru.soru8}`)
        .setStyle(1)
        .setMinLength(1)
        .setMaxLength(10)
        .setPlaceholder(`${soru.cevap8}`)
        .setRequired(true)
      ),
    new ActionRowBuilder()
      .setComponents(
          new TextInputBuilder()
          .setCustomId("soru2")
          .setLabel(`${soru.soru2}`)
          .setStyle(1)
          .setMinLength(5)
          .setMaxLength(100)
          .setPlaceholder(`${soru.cevap2}`)
          .setRequired(true)
      )
  )
  if (i.customId === "yayin") {
      i.showModal(modal)
  }
  let message ;
  let yayƒ±nlog = client.channels.cache.get(config.yayƒ±nlog)

  if (i.customId === "yayinci") {

      const kabulet8 = new ButtonBuilder()
      .setCustomId("basvuru_kabul8")
      .setLabel("Kabul Et")
      .setStyle(3)
      .setEmoji("‚úÖ")

      const reddet8 = new ButtonBuilder()
      .setCustomId("basvuru_red8")
      .setLabel("Reddet")
      .setStyle(1)
      .setEmoji("‚ùå")

      const row4 = new ActionRowBuilder()
      .addComponents(kabulet8,reddet8)

      
      const soru9 = i.fields.getTextInputValue("soru9");
      const soru8 = i.fields.getTextInputValue("soru8");
      const soru2 = i.fields.getTextInputValue("soru2");

      const kral = new EmbedBuilder()
      .setColor("Random")
      .setAuthor({ name: `${i.guild.name} Yayƒ±ncƒ± Sistemi`})
      .setThumbnail(i.guild.iconURL())
      .setDescription(`
      **${i.user.tag}** - (\`${i.user.id}\`) ** Yayƒ±ncƒ± Form**
      
      **${soru.soru9}**
      \`${soru9}\`
      **${soru.soru8}**
      \`${soru8}\`
      **${soru.soru2}**
      \`${soru2}\`
      `)
      .setTimestamp()

      await i.reply({ content: `Yayƒ±ncƒ± ba≈üvuru formunuz alƒ±ndƒ±`, ephemeral: true})
      message = await yayƒ±nlog.send({ content: `${i.user}`, embeds: [kral], components: [row4]})
      db.set(message.id,i.user.id)
  }

  const basvuruDurum = client.channels.cache.get(config.basvuruDurum)

  if (i.customId === "basvuru_kabul8") {

      if (!i.member.roles.cache.has(config.basvuruYt)) return i.reply({ content: `Ba≈üvuruyu yanƒ±tlamak i√ßin <@&${config.basvuruYt}> rol√ºne sahip olmalƒ±sƒ±n`, ephemeral: true})

      const kabulet8 = new ButtonBuilder()
      .setCustomId("basvuru_kabul8")
      .setLabel("Kabul Edildi")
      .setStyle(3)
      .setEmoji("‚úÖ")
      .setDisabled(true)


      const row5 = new ActionRowBuilder()
      .addComponents(kabulet8)

      i.update({ components: [row5]})
      let ki≈üi = db.get(i.message.id)
      let kullanƒ±cƒ± = i.client.guilds.cache.get(config.guildID).members.cache.get(ki≈üi) 
      kullanƒ±cƒ±.roles.add(config.yayƒ±nrol)
      await basvuruDurum.send({ content: `> <@${ki≈üi}>,Yayƒ±ncƒ± olarak aramƒ±za kabul edildiniz <a:green:1091729532249186397> \n> **Sizi onaylayan ki≈üi: **${i.user.toString()}`})
      kullanƒ±cƒ±.user.send(`Yayƒ±ncƒ± ba≈üvurun kabul edildi **Onaylanmƒ±≈ütƒ±r**`).catch(() => {});
      db.delete(i.message.id)
  } 
  if (i.customId === "basvuru_red8") {

      let ki≈üi = db.get(i.message.id)
      let kullanƒ±cƒ± = i.client.guilds.cache.get(config.guildID).members.cache.get(ki≈üi)

      const reddet8 = new ButtonBuilder()
      .setCustomId("ba≈üvuru_red8")
      .setLabel("Reddedildi")
      .setStyle(1)
      .setEmoji("‚ùå")
      .setDisabled(true)

      const row6 = new ActionRowBuilder()
      .addComponents(reddet8)
      await basvuruDurum.send({ content: `> <@${ki≈üi}>, Yayƒ±ncƒ± ba≈üvurunuz kabul edilmedi <a:red:1086374243404619886> \n> **Sizi onaylamayan ki≈üi: **${i.user.toString()}`})
      i.update({ components: [row6]})
      kullanƒ±cƒ±.user.send(`Yayƒ±ncƒ± ba≈üvurun kabul edilmedi`).catch(() => {});
      db.delete(i.message.id)
  }
})
//Sorun √ß√∂zme
client.on("interactionCreate", async (i) => {

  const modal = new ModalBuilder()
  .setCustomId('soruncu')
  .setTitle('Sorununuz nedir ?')
  .setComponents(
    new ActionRowBuilder()
      .setComponents(
          new TextInputBuilder()
          .setCustomId("soru10")
          .setLabel(`${soru.soru10}`)
          .setStyle(1)
          .setMinLength(5)
          .setMaxLength(100)
          .setPlaceholder(`${soru.cevap10}`)
          .setRequired(true)
      )
  )
  if (i.customId === "sorun") {
      i.showModal(modal)
  }
  let message ;
  let sorunlog = client.channels.cache.get(config.sorunlog)

  if (i.customId === "soruncu") {

      const kabulet9 = new ButtonBuilder()
      .setCustomId("basvuru_kabul9")
      .setLabel("√á√∂zmeye git")
      .setStyle(3)
      .setEmoji("üìû")

      const row4 = new ActionRowBuilder()
      .addComponents(kabulet9)

      
      const soru10 = i.fields.getTextInputValue("soru10");

      const kral = new EmbedBuilder()
      .setColor("Random")
      .setAuthor({ name: `${i.guild.name} Sorun √ß√∂zme`})
      .setThumbnail(i.guild.iconURL())
      .setDescription(`
      **${i.user.tag}** - (\`${i.user.id}\`) ** Sorun √ß√∂zme yetkili √ßaƒüƒ±r**
      
      **${soru.soru10}**
      \`${soru10}\`
      `)
      .setTimestamp()

      await i.reply({ content: `Sorun √ß√∂zme yetkilimiz geliyor beklemede kalƒ±n`, ephemeral: true})
      message = await sorunlog.send({ content: `${i.user}`, embeds: [kral], components: [row4]})
      db.set(message.id,i.user.id)
  }

  const essek = client.channels.cache.get(config.sorunlog)

  if (i.customId === "basvuru_kabul9") {

      if (!i.member.roles.cache.has(config.sorunYt)) return i.reply({ content: `Sorunlarƒ± √ß√∂zmek i√ßin <@&${config.sorunYt}> rol√ºne sahip olmalƒ±sƒ±n`, ephemeral: true})

      const kabulet9 = new ButtonBuilder()
      .setCustomId("basvuru_kabul9")
      .setLabel("√á√∂zmeye gidiyorum")
      .setStyle(3)
      .setEmoji("‚úÖ")
      .setDisabled(true)


      const row5 = new ActionRowBuilder()
      .addComponents(kabulet9)

      i.update({ components: [row5]})
      let ki≈üi = db.get(i.message.id)
      let kullanƒ±cƒ± = i.client.guilds.cache.get(config.guildID).members.cache.get(ki≈üi) 
      kullanƒ±cƒ±.roles.add(config.yayƒ±nrol)
      await essek.send({ content: `<@${ki≈üi}>`})
      kullanƒ±cƒ±.user.send(`Sorununu √ß√∂zmeye geliyoruz`).catch(() => {});
      db.delete(i.message.id)
  } 
})
const { joinVoiceChannel } = require('@discordjs/voice')
client.on('ready', () => {
  let channel = client.channels.cache.get(config.botses) 
  

      const VoiceConnection = joinVoiceChannel({
          channelId: channel.id, 
          guildId: channel.guild.id,
          adapterCreator: channel.guild.voiceAdapterCreator 
  });
})
